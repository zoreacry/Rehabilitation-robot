clc
clear
%--------------------------------------------------------------------------
%输入阻抗控制时的位姿，速度加速度
%外力由于无，则进行模拟
%----------------------------------------------------------------------------
%使用二阶+一阶成分进行模拟
%设定：M=5；B=2;K=3;
%环境力C=4;
%-----------------------------------------
i=1;     %时间次数t=i*0.01
%---------------------------------------------------------
% 在碰到一些物体时，通过此种方法可以迅速停止当前运动，保护机器或操作员
%修改：
%1.M\B\K
%2.修改F_ext  应与运动平台传感器力同
%--------------------------------------------
M=[1,0,0,0,0,0;...
   0,1,0,0,0,0;...
   0,0,1,0,0,0;...
   0,0,0,1,0,0;...
   0,0,0,0,1,0;...
   0,0,0,0,0,1];
B=[2,0,0,0,0,0;...
   0,1,0,0,0,0;...
   0,0,1,0,0,0;...
   0,0,0,1,0,0;...
   0,0,0,0,2,0;...
   0,0,0,0,0,4];
K=[1,0,0,0,0,0;...
   0,1,0,0,0,0;...
   0,0,1,0,0,0;...
   0,0,0,1,0,0;...
   0,0,0,0,1,0;...
   0,0,0,0,0,1];
C=[1,0,0,0,0,0;...
   0,1,0,0,0,0;...
   0,0,1,0,0,0;...
   0,0,0,1,0,0;...
   0,0,0,0,1,0;...
   0,0,0,0,0,1];
%---------------------------------------------------------------------------------------------------
Con_1=ones(1,50);
Con_2=zeros(1,50);
Con_3=zeros(1,50);
Con_4=zeros(1,50);
Con_5=zeros(1,50);
Con_6=zeros(1,50);
%----------------------------------初始数据----------------------------------------------
T_s=0.01;         %s
m=20;            %kg
dx_re=   [5;2;6;10;10;10];        %m             %初始位姿
dx_d_re= [5;4;10;2;1;8];      %m/s           %速度
dx_dd_re=[2;2;2;2;2;2];     %m/s'2         %加速度

%-------------------------------------设定环境模拟力---------------------------------------------
F_ext=C*dx_re;                                                             %弹簧力(受外力/墙)
%-----------------------------------------------------------------
%F_ext=M*dx_dd+B*dx_d+K*dx

Jud_1=dx_d_re(2)+dx_d_re(3)+dx_d_re(4)+dx_d_re(5)+dx_d_re(6);         %判断域（不一定合理）
while Jud_1 > 0.001 
    
   
   F_ext=C*dx_re;
    
   dx_dd_act= inv(M)*(F_ext-B*dx_d_re-K*dx_re);
   dx_d_act = (T_s/2)*(dx_dd_act+dx_dd_re)+dx_d_re;
   dx_act   = (T_s/2)*(dx_d_act+dx_d_re)+dx_re;
   
   F_act=M*dx_dd_act+B*dx_d_re+K*dx_re;
    dx_dd_re = dx_dd_act;
    dx_d_re = dx_d_act;
    dx_re = dx_act;
    
    
    Con_1(i)=dx_re(1);
    Con_2(i)=dx_re(2);
    Con_3(i)=dx_re(3);
    Con_4(i)=dx_re(4);
    Con_5(i)=dx_re(5);
    Con_6(i)=dx_re(6);
    
    Jud_1=dx_d_re(2)+dx_d_re(3)+dx_d_re(4)+dx_d_re(5)+dx_d_re(6);
    
   i=i+1;
end
 hold on;
 plot(Con_1);
 plot(Con_2);
 plot(Con_3);
 plot(Con_4);
 plot(Con_5);
 plot(Con_6);
 
 legend('1','2','3','4','5','6');